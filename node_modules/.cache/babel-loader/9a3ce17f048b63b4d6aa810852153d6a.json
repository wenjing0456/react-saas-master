{"ast":null,"code":"import axios from 'axios';\nimport qs from 'qs';\nexport default function fetch(opt) {\n  let ContentType = 'application/json;charset=UTF-8';\n\n  if (opt.ContentType === 'form') {\n    ContentType = 'application/x-www-form-urlencoded';\n  } else if (opt.ContentType === 'form-data') {\n    ContentType = 'multipart/form-data';\n  }\n\n  var dataList = {\n    method: opt.method,\n    url: \"\".concat(api).concat(opt.url),\n    baseURL,\n    headers: {\n      'Content-Type': ContentType,\n      'token': localStorage.token\n    },\n    withCredentials: true\n  };\n\n  if (['post', 'put'].includes(opt.method)) {\n    opt.ContentType === 'form' ? dataList.data = qs.stringify(opt.data) : dataList.data = opt.data;\n  } else {\n    // 防止缓存\n    if (opt.data) {\n      opt.data.r = new Date().getTime() + Math.random();\n      dataList.params = opt.data;\n    } else {\n      dataList.params = {\n        r: new Date().getTime() + Math.random()\n      };\n    }\n  }\n\n  return new Promise((resolve, reject) => {\n    axios(dataList).then(res => {\n      commonFun(res.data);\n      resolve(res.data);\n    }).catch(error => {\n      reject(error.data);\n    });\n  });\n} // 发送请求前处理数据\n\naxios.interceptors.request.use(config => {\n  Indicator.open();\n  return config;\n}, error => {\n  Indicator.close();\n  return Promise.reject(error);\n}); // 返回响应请求后处理数据\n\naxios.interceptors.response.use(res => {\n  Indicator.close();\n  return res;\n}, error => {\n  Indicator.close();\n  let errorCode = error.response.status;\n\n  if (errorCode === 401) {\n    utils.$go('login');\n  } else if ([405, 500, 503, 504].includes(errorCode)) {\n    error.response.data = {\n      msg: '网络错误,请稍后重试!'\n    };\n  }\n\n  return Promise.reject(error.response);\n});","map":{"version":3,"sources":["/Users/wenjing/Documents/testPro/reactTest/react-saas-master/src/utils/fetch.js"],"names":["axios","qs","fetch","opt","ContentType","dataList","method","url","api","baseURL","headers","localStorage","token","withCredentials","includes","data","stringify","r","Date","getTime","Math","random","params","Promise","resolve","reject","then","res","commonFun","catch","error","interceptors","request","use","config","Indicator","open","close","response","errorCode","status","utils","$go","msg"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport qs from 'qs'\n\nexport default function fetch(opt){\n    let ContentType = 'application/json;charset=UTF-8';\n    if (opt.ContentType === 'form') {\n        ContentType = 'application/x-www-form-urlencoded';\n    } else if (opt.ContentType === 'form-data') {\n        ContentType = 'multipart/form-data';\n    }\n    var dataList = {\n        method: opt.method,\n        url: `${api}${opt.url}`,\n        baseURL,\n        headers: {\n            'Content-Type': ContentType,\n            'token': localStorage.token\n        },\n        withCredentials: true\n    }\n    if (['post', 'put'].includes(opt.method)) {\n        opt.ContentType === 'form' ? dataList.data = qs.stringify(opt.data) : dataList.data = opt.data;\n    } else {\n        // 防止缓存\n        if (opt.data) {\n            opt.data.r = new Date().getTime() + Math.random()\n            dataList.params = opt.data;\n        } else {\n            dataList.params = { r: new Date().getTime() + Math.random()}\n        }\n    }\n    return new Promise((resolve, reject) => {\n        axios(dataList)\n            .then(res => {\n                commonFun(res.data)\n                resolve(res.data)\n            })\n            .catch(error => {\n                reject(error.data)\n            })\n    })\n}\n// 发送请求前处理数据\naxios.interceptors.request.use(config => {\n  Indicator.open();\n  return config;\n}, error => {\n  Indicator.close();\n  return Promise.reject(error);\n});\n\n// 返回响应请求后处理数据\naxios.interceptors.response.use(res => {\n  Indicator.close();\n  return res;\n}, error => {\n  Indicator.close();\n  let errorCode = error.response.status;\n  if (errorCode === 401) {\n      utils.$go('login');\n  } else if ([405, 500, 503, 504].includes(errorCode)) {\n      error.response.data = {\n          msg: '网络错误,请稍后重试!'\n      };\n  }\n  return Promise.reject(error.response)\n});\n"]},"metadata":{},"sourceType":"module"}